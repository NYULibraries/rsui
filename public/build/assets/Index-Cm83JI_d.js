import{j as e,r as l,a as te,b as se,H as re}from"./app-B-SMFcR8.js";import{c as B,u as ae,a as ne,R as oe,A as le,b as g,P as W,d as ie,D as ce,C as de,e as ue,f as pe,T as me,g as he,h as xe,X as fe,i as je,j as ge,k as ve,O as Ne,l as U,S as be,m as we,n as ye,o as Ce,p as Pe,q as _e}from"./app-layout-DvLGCao6.js";import{P as Se,I as De}from"./index-CZG6tVgv.js";import{c as K,a as b}from"./createLucideIcon-DOsiuD-Y.js";import{u as Re,B as G}from"./app-logo-icon-CeAj1Gdf.js";import{C as Te}from"./card-UnbLGVAQ.js";import{F as Ee}from"./FilePreviewer-DK-ghHBx.js";import{T as ke,a as He,b as j,c as p}from"./table-CwlFPfFN.js";/* empty css            */import"./index-BQ7f94Jo.js";import"./loader-circle-WXhtj_gx.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Le=K("ChevronDown",Oe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ae=K("ChevronUp",ze);function _({className:t,...r}){return e.jsx("div",{"data-slot":"skeleton",className:b("bg-primary/10 animate-pulse rounded-md",t),...r})}var O,T="HoverCard",[V]=ne(T,[B]),E=B(),[$e,k]=V(T),q=t=>{const{__scopeHoverCard:r,children:n,open:a,defaultOpen:i,onOpenChange:u,openDelay:c=700,closeDelay:x=300}=t,m=E(r),v=l.useRef(0),h=l.useRef(0),P=l.useRef(!1),N=l.useRef(!1),[y,o]=ae({prop:a,defaultProp:i??!1,onChange:u,caller:T}),w=l.useCallback(()=>{clearTimeout(h.current),v.current=window.setTimeout(()=>o(!0),c)},[c,o]),C=l.useCallback(()=>{clearTimeout(v.current),!P.current&&!N.current&&(h.current=window.setTimeout(()=>o(!1),x))},[x,o]),H=l.useCallback(()=>o(!1),[o]);return l.useEffect(()=>()=>{clearTimeout(v.current),clearTimeout(h.current)},[]),e.jsx($e,{scope:r,open:y,onOpenChange:o,onOpen:w,onClose:C,onDismiss:H,hasSelectionRef:P,isPointerDownOnContentRef:N,children:e.jsx(oe,{...m,children:n})})};q.displayName=T;var Q="HoverCardTrigger",X=l.forwardRef((t,r)=>{const{__scopeHoverCard:n,...a}=t,i=k(Q,n),u=E(n);return e.jsx(le,{asChild:!0,...u,children:e.jsx(Se.a,{"data-state":i.open?"open":"closed",...a,ref:r,onPointerEnter:g(t.onPointerEnter,R(i.onOpen)),onPointerLeave:g(t.onPointerLeave,R(i.onClose)),onFocus:g(t.onFocus,i.onOpen),onBlur:g(t.onBlur,i.onClose),onTouchStart:g(t.onTouchStart,c=>c.preventDefault())})})});X.displayName=Q;var L="HoverCardPortal",[Ue,Fe]=V(L,{forceMount:void 0}),Y=t=>{const{__scopeHoverCard:r,forceMount:n,children:a,container:i}=t,u=k(L,r);return e.jsx(Ue,{scope:r,forceMount:n,children:e.jsx(W,{present:n||u.open,children:e.jsx(ie,{asChild:!0,container:i,children:a})})})};Y.displayName=L;var D="HoverCardContent",J=l.forwardRef((t,r)=>{const n=Fe(D,t.__scopeHoverCard),{forceMount:a=n.forceMount,...i}=t,u=k(D,t.__scopeHoverCard);return e.jsx(W,{present:a||u.open,children:e.jsx(Me,{"data-state":u.open?"open":"closed",...i,onPointerEnter:g(t.onPointerEnter,R(u.onOpen)),onPointerLeave:g(t.onPointerLeave,R(u.onClose)),ref:r})})});J.displayName=D;var Me=l.forwardRef((t,r)=>{const{__scopeHoverCard:n,onEscapeKeyDown:a,onPointerDownOutside:i,onFocusOutside:u,onInteractOutside:c,...x}=t,m=k(D,n),v=E(n),h=l.useRef(null),P=Re(r,h),[N,y]=l.useState(!1);return l.useEffect(()=>{if(N){const o=document.body;return O=o.style.userSelect||o.style.webkitUserSelect,o.style.userSelect="none",o.style.webkitUserSelect="none",()=>{o.style.userSelect=O,o.style.webkitUserSelect=O}}},[N]),l.useEffect(()=>{if(h.current){const o=()=>{y(!1),m.isPointerDownOnContentRef.current=!1,setTimeout(()=>{var C;((C=document.getSelection())==null?void 0:C.toString())!==""&&(m.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",o),()=>{document.removeEventListener("pointerup",o),m.hasSelectionRef.current=!1,m.isPointerDownOnContentRef.current=!1}}},[m.isPointerDownOnContentRef,m.hasSelectionRef]),l.useEffect(()=>{h.current&&We(h.current).forEach(w=>w.setAttribute("tabindex","-1"))}),e.jsx(ce,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:c,onEscapeKeyDown:a,onPointerDownOutside:i,onFocusOutside:g(u,o=>{o.preventDefault()}),onDismiss:m.onDismiss,children:e.jsx(de,{...v,...x,onPointerDown:g(x.onPointerDown,o=>{o.currentTarget.contains(o.target)&&y(!0),m.hasSelectionRef.current=!1,m.isPointerDownOnContentRef.current=!0}),ref:P,style:{...x.style,userSelect:N?"text":void 0,WebkitUserSelect:N?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})})}),Ie="HoverCardArrow",Be=l.forwardRef((t,r)=>{const{__scopeHoverCard:n,...a}=t,i=E(n);return e.jsx(ue,{...i,...a,ref:r})});Be.displayName=Ie;function R(t){return r=>r.pointerType==="touch"?void 0:t()}function We(t){const r=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)r.push(n.currentNode);return r}var Ke=q,Ge=X,Ve=Y,qe=J;function F({...t}){return e.jsx(Ke,{"data-slot":"hover-card",openDelay:300,...t})}function M({...t}){return e.jsx(Ge,{"data-slot":"hover-card-trigger",...t})}function I({className:t,align:r="center",sideOffset:n=4,...a}){return e.jsx(Ve,{"data-slot":"hover-card-portal",children:e.jsx(qe,{"data-slot":"hover-card-content",align:r,sideOffset:n,className:b("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...a})})}const Qe=()=>e.jsxs("div",{className:"p-4",children:[e.jsx(_,{className:"h-6 w-48 mb-4"}),e.jsx(_,{className:"h-10 rounded-md"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4",children:Array.from({length:8}).map((t,r)=>e.jsxs(Te,{className:"p-4",children:[e.jsx(_,{className:"h-6 w-6 mb-2 mx-auto"}),e.jsx(_,{className:"h-4 w-24 mx-auto mb-1"}),e.jsx(_,{className:"h-3 w-20 mx-auto"})]},r))})]});function Xe({...t}){return e.jsx(pe,{"data-slot":"dialog",...t})}function Ye({...t}){return e.jsx(me,{"data-slot":"dialog-trigger",...t})}function Je({...t}){return e.jsx(ve,{"data-slot":"dialog-portal",...t})}function Ze({className:t,...r}){return e.jsx(Ne,{"data-slot":"dialog-overlay",className:b("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",t),...r})}function et({className:t,children:r,...n}){return e.jsxs(Je,{"data-slot":"dialog-portal",children:[e.jsx(Ze,{}),e.jsxs(he,{"data-slot":"dialog-content",className:b("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...n,children:[r,e.jsxs(xe,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(fe,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function tt({className:t,...r}){return e.jsx("div",{"data-slot":"dialog-header",className:b("flex flex-col gap-2 text-center sm:text-left",t),...r})}function st({className:t,...r}){return e.jsx(je,{"data-slot":"dialog-title",className:b("text-lg leading-none font-semibold",t),...r})}function rt({className:t,...r}){return e.jsx(ge,{"data-slot":"dialog-description",className:b("text-muted-foreground text-sm",t),...r})}const at=({item:t,triggerLabel:r})=>{const[n,a]=l.useState(!1),i=c=>c.object_type==="file"&&c.size!==void 0&&c.size<2*1024*1024*1024,u=t.preview_url;return e.jsxs(Xe,{open:n,onOpenChange:a,children:[e.jsx(Ye,{asChild:!0,children:e.jsx(G,{asChild:!0,variant:"link",className:"cursor-pointer hover:underline p-0 h-auto",children:e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",onClick:c=>{!c.ctrlKey&&!c.metaKey&&!c.shiftKey&&c.button===0&&(c.preventDefault(),a(!0))},children:r})})}),e.jsxs(et,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(tt,{children:[e.jsx(st,{children:"File Previewer"}),e.jsx(rt,{children:i(t)&&t.download_url?e.jsxs("span",{children:["Displaying file: ",e.jsx("span",{children:e.jsx("a",{href:t.download_url,className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:t.name})})]}):e.jsxs("span",{children:["Displaying file: ",e.jsx("span",{className:"font-mono text-sm text-gray-600 break-all",children:t.name})]})})]}),e.jsx("div",{className:"py-4",children:e.jsx(Ee,{item:t})})]})]})},nt=({storage:t,partnerId:r,collectionId:n})=>{const[a,i]=l.useState(null),[u,c]=l.useState(null),[x,m]=l.useState([]),[v,h]=l.useState(""),[P,N]=l.useState("table"),[y,o]=l.useState(!1);l.useEffect(()=>{if(t&&t.length>0){const s=t[t.length-1],d=t.slice(0,t.length-1).filter(f=>!!f.url);w(s),m(d),c(null),h("")}},[t]),l.useEffect(()=>{const s=d=>{d.state&&(m(d.state.history),i(d.state.currentData))};return window.addEventListener("popstate",s),()=>{window.removeEventListener("popstate",s)}},[]),l.useEffect(()=>{if(a&&a.url){const s=`/fs/paths/${r}/${n}`;let d="";if(a.url===s)d=`/collections/${n}`;else if(a.url.startsWith(s+"/")){const f=a.url.substring(s.length+1);d=`/paths/${r}/${n}/${f}`}else d=`/collections/${n}`;window.history.pushState({history:x,currentData:a},"",d)}},[a,x,r,n,t]);const w=async s=>{o(!0);try{if(!s.url){console.error("Error: Attempted to fetch data for an item with no URL:",s);return}const f=await(await fetch(s.url)).json();i(f)}finally{o(!1)}},C=async s=>{if(s.object_type==="directory"){if(o(!0),!s.url){console.error("Error: Clicked directory has no URL:",s),o(!1);return}const f=await(await fetch(s.url)).json();a&&(a.object_type==="directory"&&!a.url&&console.warn("Warning: Attempting to add a directory to history without a URL:",a),m(S=>[...S,a])),i(f),h(""),c(null),o(!1)}else c(s.name)},H=async s=>{o(!0);const d=x[s];if(!d||!d.url){console.error("Error: Target history item has no URL or is null:",d),o(!1);return}const f=x.slice(0,s);await w(d),m(f),c(null),h(""),o(!1)},z=s=>new Date(s).toLocaleString(),Z=s=>s.object_type==="file"&&s.size!==void 0&&s.size<2*1024*1024*1024;if(y)return e.jsx(Qe,{});if(!a)return e.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"No data"});const A=(a.children||[]).filter(s=>s.name.toLowerCase().includes(v.toLowerCase()));return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-2 text-sm text-muted-foreground flex flex-wrap items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:"Path:"}),x.map((s,d)=>e.jsxs("span",{className:"flex items-center",children:[s.url?e.jsx("button",{onClick:()=>H(d),className:"text-primary cursor-pointer underline hover:text-primary/80",title:s.name,children:s.name}):e.jsx("span",{className:"text-muted-foreground",title:`Unnavigable: ${s.name}`,children:s.name}),e.jsx(U,{className:"w-4 h-4 text-muted-foreground/50 mx-1"})]},s.url||d)),a.name&&e.jsx("span",{title:a.name,children:a.name})]}),e.jsx("div",{className:"flex items-center justify-between mb-4 gap-4 flex-wrap",children:e.jsxs("div",{className:"relative max-w-sm w-full",children:[e.jsx(be,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(De,{type:"text",placeholder:"Filter files or folders...",value:v,onChange:s=>h(s.target.value),className:"pl-8"})]})}),A.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Empty directory."}):e.jsx("div",{className:"overflow-x-auto border rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-muted text-left sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 font-medium",children:"Name"}),e.jsx("th",{className:"p-2 font-medium",children:"Type"}),e.jsx("th",{className:"p-2 font-medium",children:"Size"}),e.jsx("th",{className:"p-2 font-medium",children:"Preview"}),e.jsx("th",{className:"p-2 font-medium",children:"Download"}),e.jsx("th",{className:"p-2 font-medium",children:"Last Modified"}),e.jsx("th",{className:"p-2 font-medium"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:A.map((s,d)=>{const f=d%2===0,S=b(f?"bg-background":"bg-muted/50","hover:bg-accent",s.object_type==="directory"&&"cursor-pointer",u===s.name&&"ring ring-primary");if(console.log(s),s.preview=!1,s.size&&s.size>0&&s.mime_type)switch(s.mime_type){case"application/xml":case"application/json":case"text/plain":case"text/csv":case"text/xsl":case"application/xslt+xml":case"audio/wav":case"audio/mpeg":case"audio/ogg":case"audio/aac":case"video/mp4":case"video/webm":case"video/ogg":case"text/html":s.preview=!0;break}const ee=s.is_empty_dir===!0;if(s.object_type==="file")return e.jsxs("tr",{className:S,tabIndex:0,children:[e.jsx("td",{className:"p-2 max-w-xs",title:s.name,children:s.name}),e.jsx("td",{className:"p-2",children:s.object_type}),e.jsx("td",{className:"p-2",children:s.display_size}),e.jsx("td",{className:"p-2",children:s.preview&&s.download_url?e.jsx(at,{item:s,triggerLabel:"Preview"}):e.jsx("div",{children:e.jsxs(F,{children:[e.jsx(M,{children:e.jsx("span",{className:"text-muted-foreground/50",children:"Not available"})}),e.jsx(I,{children:e.jsx("span",{children:"Unavailable at the moment â€” please check back soon."})})]})})}),e.jsx("td",{className:"p-2",children:Z(s)&&s.download_url?e.jsx("a",{href:s.download_url,className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:"Download"}):e.jsxs(F,{children:[e.jsx(M,{children:e.jsx("span",{className:"text-muted-foreground/50",children:"N/A"})}),e.jsx(I,{children:e.jsx("span",{children:"Download for files over 2GB of size is not currently supported."})})]})}),e.jsx("td",{className:"p-2",children:z(s.last_modified)}),e.jsx("td",{className:"p-2"})]},s.name);if(s.object_type==="directory"){let $="directory";return ee&&($="empty directory"),e.jsxs("tr",{className:S,onClick:()=>C(s),tabIndex:0,children:[e.jsx("td",{className:"p-2 truncate max-w-xs",title:s.name,children:s.name}),e.jsx("td",{className:"p-2",children:$}),e.jsx("td",{className:"p-2"}),e.jsx("td",{className:"p-2"}),e.jsx("td",{className:"p-2"}),e.jsx("td",{className:"p-2",children:z(s.last_modified)}),e.jsx("td",{className:"p-2",children:e.jsx(U,{size:24,className:"text-gray-400"})})]},s.name)}return null})})]})})]})};function jt(){const{collection:t,storage_path:r}=te().props,{partner:n}=t,{collectionDetailsCollapsed:a}=se(),[i,u]=l.useState(!a);l.useEffect(()=>{u(!a)},[a]);const c=[{title:"Partners",href:"/dashboard"},{title:n.name,href:`/partners/${n.id}`},{title:t.name,href:`/collections/${t.id}`}];return e.jsxs(we,{breadcrumbs:c,children:[e.jsx(re,{title:`${t.name} - ${n.name}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto",children:[e.jsx("h4",{className:"scroll-m-20 text-xl font-semibold tracking-tight",children:t.name}),e.jsxs("div",{className:"rounded-md border",children:[e.jsx(ye,{children:e.jsxs(Ce,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(G,{onClick:()=>u(!i),variant:"ghost",className:"w-full flex justify-between items-center px-4 py-2 cursor-pointer",children:[e.jsx("h5",{className:"scroll-m-20 text-l font-semibold tracking-tight",children:"Collection Details"}),i?e.jsx(Ae,{}):e.jsx(Le,{})]})}),e.jsx(_e,{children:e.jsxs("p",{children:["Click to ",i?"collapse":"expand"," collection details"]})})]})}),i&&e.jsx(ke,{id:"collection-details-table",className:"w-full",children:e.jsxs(He,{children:[e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"Partner Name"}),e.jsx(p,{children:n.name})]}),e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"Partner Code"}),e.jsx(p,{children:n.code})]}),e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"Partner R* Path"}),e.jsx(p,{children:n.path})]}),e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"Collection Long Name"}),e.jsx(p,{children:t.name})]}),e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"Collection Code"}),e.jsx(p,{children:t.display_code})]}),e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"Collection R* Code"}),e.jsx(p,{children:t.code})]}),e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"R* Path"}),e.jsx(p,{children:t.path})]}),e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"Ready for Content?"}),e.jsx(p,{children:t.ready_for_content?"Yes":"No"})]}),e.jsxs(j,{children:[e.jsx(p,{className:"font-medium",children:"Quota (GB)"}),e.jsx(p,{children:t.quota.toLocaleString()})]})]})})]}),e.jsx("h5",{className:"scroll-m-20 text-l font-semibold tracking-tight",children:"Perspectives"}),e.jsx("div",{className:"rounded-md border",children:e.jsx(nt,{storage:r,partnerId:String(n.id),collectionId:String(t.id)})})]})]})}export{jt as default};
